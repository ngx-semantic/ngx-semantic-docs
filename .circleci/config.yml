version: 2.1
orbs:
  github: circleci/github@v2.3.0
jobs:
  build:
    docker:
      - image: cimg/node:19.7.0
    working_directory: ~/repo
    steps:
      - checkout
      - restore_cache:
          keys:
            - v1-dependencies-{{ checksum "yarn.lock" }}
            - v1-dependencies-
      - run: yarn install --frozen-lockfile
      - save_cache:
          paths:
            - node_modules
          key: v1-dependencies-{{ checksum "yarn.lock" }}
      - run: |
          node --version
          yarn --version
      - run: |
          yarn build
          cp dist/index.html dist/404.html
      - run: |
          git config --global user.email ${{ github.event.head_commit.author.email }}
          git config --global user.name "CircleCI"
          
          git clone https://github.com/ngx-semantic/ngx-semantic.github.io.git
          cd ngx-semantic.github.io
          git checkout master
          
          cp -r ~/repo/dist/* .
          
          git add .
          git commit -m "Auto-deployed from CircleCI"
          git push origin master
workflows:
  version: 2
  build-and-deploy:
    jobs:
      - build
